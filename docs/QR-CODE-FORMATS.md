# 二维码格式说明

## 概述

Tether WDK Wallet 支持两种二维码格式:

1. **简单地址格式** (Simple Address Format) - 默认推荐
2. **WDK协议格式** (WDK Protocol Format) - 高级用途

用户可以在接收对话框中通过"切换"按钮自由切换两种格式。

---

## 🎯 简单地址格式 (推荐用于接收付款)

### 特点

- **内容**: 仅包含钱包地址字符串
- **兼容性**: ✅ 与所有标准钱包应用兼容
- **用途**: 接收付款、分享收款地址
- **推荐场景**: 日常转账、收款、地址分享

### 示例

```
bc1p5cyxnuxmeuwuvkwfem96lqzszd02n6xdcjrs20cac6yqjjwudpxqkedrcr
```

或

```
0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb
```

### 优点

✅ 扫描快速  
✅ 二维码体积小  
✅ 所有钱包都能识别  
✅ 用户体验最佳  
✅ 无需特殊处理

### 使用场景

- 向他人展示收款地址
- 接收来自任何钱包的转账
- 在网站/应用中嵌入收款码
- 打印收款二维码
- 日常付款收款

---

## 🔧 WDK协议格式 (用于高级交互)

### 特点

- **内容**: 完整的 WDK 协议消息(JSON格式)
- **兼容性**: ⚠️ 仅支持 WDK 标准的钱包
- **用途**: 钱包间高级交互、信息交换
- **推荐场景**: 钱包导入、信息共享、高级功能

### 示例

```json
{
  "protocol": "WDK",
  "version": "1.0.0",
  "type": "ADDRESS_INFO",
  "timestamp": 1729411200000,
  "data": {
    "chain": "BTC",
    "network": "mainnet",
    "address": "bc1p5cyxnuxmeuwuvkwfem96lqzszd02n6xdcjrs20cac6yqjjwudpxqkedrcr",
    "publicKey": "02a1633cafcc01ebfb6d78e39f687a1f0995c62fc95f51ead10a02ee0be551b5dc",
    "label": "我的BTC钱包"
  }
}
```

### 优点

✅ 包含完整钱包信息  
✅ 支持链类型、网络类型识别  
✅ 包含公钥信息  
✅ 支持标签/备注  
✅ 可扩展性强  
✅ 安全性验证(时间戳、版本检查)

### 使用场景

- 在支持 WDK 的钱包间共享完整钱包信息
- 导入/导出钱包地址簿
- 多签钱包配置
- 钱包信息备份
- 需要验证公钥的场景
- 跨链钱包信息交换

---

## 🔄 如何切换格式

### 在应用中切换

1. 打开任意钱包
2. 点击"接收"按钮
3. 在接收对话框顶部找到"二维码格式"栏
4. 点击"切换"按钮即可在两种格式间切换
5. 二维码会实时更新

### 默认格式

- 默认使用**简单地址格式**,确保最大兼容性
- 格式选择会保存在会话中(关闭对话框不会重置)
- 每次打开应用默认恢复为简单格式

---

## 📊 格式对比表

| 特性 | 简单地址格式 | WDK协议格式 |
|------|------------|------------|
| **内容** | 仅地址字符串 | 完整JSON协议消息 |
| **二维码大小** | 小 (~200 bytes) | 大 (~500-1000 bytes) |
| **扫描速度** | 快 | 较慢 |
| **兼容性** | 所有钱包 | 仅WDK标准钱包 |
| **信息量** | 少 (仅地址) | 多 (地址+公钥+链类型+网络+标签) |
| **用途** | 接收付款 | 高级交互 |
| **推荐场景** | ✅ 日常使用 | ⚠️ 特殊需求 |
| **错误率** | 低 | 略高(数据量大) |
| **安全验证** | 无 | 有(时间戳、版本) |

---

## 🎓 使用建议

### 何时使用简单地址格式

✅ **推荐使用** 在以下场景:

1. 日常接收转账
2. 向朋友/商家展示收款码
3. 在不确定对方钱包类型时
4. 需要打印二维码时
5. 网络环境不佳时(二维码更小,扫描更快)
6. 移动设备扫描时

### 何时使用WDK协议格式

⚠️ **特殊场景** 使用:

1. 在两个 WDK 标准钱包间交互
2. 需要传递完整钱包信息(地址+公钥)
3. 多签钱包配置
4. 钱包间地址簿同步
5. 需要验证公钥的高级场景
6. 企业级钱包管理系统

---

## 🔍 识别指南

### 扫描时如何判断格式

应用会自动识别扫描到的二维码格式:

1. **简单格式**: 
   - 纯地址字符串
   - 以 `bc1`, `0x`, `1`, `3` 等地址前缀开头
   
2. **WDK协议格式**:
   - JSON格式
   - 包含 `"protocol": "WDK"` 字段
   - 自动解析并显示完整信息

### 扫描结果显示

- **简单格式**: 直接显示地址,可复制或发起转账
- **WDK格式**: 显示完整信息卡片,包括:
  - 协议类型和版本
  - 链类型和网络
  - 地址和公钥
  - 标签/备注
  - 时间戳

---

## 🛡️ 安全说明

### 简单地址格式安全性

- ✅ 无法伪造(地址本身是加密哈希)
- ✅ 可通过区块链浏览器验证
- ⚠️ 无时间戳验证
- ⚠️ 无链类型验证(需手动确认)

### WDK协议格式安全性

- ✅ 时间戳验证(±5分钟有效期)
- ✅ 版本兼容性检查
- ✅ 链类型和网络自动验证
- ✅ 公钥可用于地址验证
- ✅ 完整性检查(JSON格式验证)

**建议**: 
- 日常转账使用简单格式即可
- 高价值交易或企业场景使用WDK格式增强安全性

---

## 💡 技术实现

### 简单格式生成代码

```typescript
// 直接使用地址生成二维码
QRCode.toDataURL(wallet.address, {
  width: 200,
  margin: 2,
  errorCorrectionLevel: 'M',
});
```

### WDK协议格式生成代码

```typescript
// 使用协议工具类生成
const addressInfo = ProtocolUtils.createAddressInfo({
  chain: wallet.chain,
  network: wallet.network,
  address: wallet.address,
  publicKey: wallet.publicKey,
  label: wallet.name,
});
const qrData = ProtocolUtils.serializeMessage(addressInfo);
QRCode.toDataURL(qrData, {
  width: 200,
  margin: 2,
  errorCorrectionLevel: 'M',
});
```

### 扫描识别代码

```typescript
// 自动识别格式
try {
  // 尝试解析为 WDK 协议
  const message = ProtocolUtils.parseMessage(scannedData);
  const validation = ProtocolUtils.validateMessage(message);
  
  if (validation.isValid) {
    // 是 WDK 协议格式
    handleProtocolFormat(message);
  }
} catch (error) {
  // 不是 WDK 协议,当作简单地址处理
  handleSimpleAddress(scannedData);
}
```

---

## 📝 常见问题

### Q: 我应该默认使用哪种格式?

**A**: 推荐使用**简单地址格式**,因为它兼容性最好,适合99%的日常使用场景。

### Q: WDK协议格式的二维码为什么扫不了?

**A**: 可能原因:
1. 对方钱包不支持 WDK 协议
2. 二维码数据量大,扫描距离太远
3. 光线不足导致识别困难
4. 时间戳已过期(超过±5分钟)

**解决方案**: 切换回简单地址格式即可。

### Q: 两种格式可以混用吗?

**A**: 可以!应用会自动识别扫描到的格式类型:
- 简单格式 → 当作普通地址处理
- WDK格式 → 解析完整协议信息

### Q: 切换格式后原来的二维码还能用吗?

**A**: 能用!两种格式包含的核心信息(钱包地址)是相同的,只是包装方式不同。简单格式被更多钱包支持。

### Q: 如何验证扫描到的地址是否正确?

**A**: 
- **简单格式**: 手动核对地址前几位和后几位
- **WDK格式**: 应用会自动验证时间戳、链类型、版本等,更安全

---

## 🔗 相关文档

- [WDK协议完整规范](./protocol.md)
- [协议使用指南](./protocol-usage-guide.md)
- [快速开始指南](./QUICK-START.md)
- [协议概述](./WDK-PROTOCOL-OVERVIEW.md)

---

## 📞 支持

如有任何问题或建议,请联系开发团队。

**Tether WDK Wallet** - 让冷钱包交互更简单、更安全! 🚀
