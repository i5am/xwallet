# 密码功能使用说明

## 功能概述

XWallet 现已支持密码保护功能，用于保护您的私钥和助记词安全。

## 功能特性

### 1. 密码设置
- **位置**: 设置 → 密码设置
- **功能**: 
  - 首次设置密码（至少6位）
  - 修改已有密码
- **安全性**: 
  - 使用 SHA-256 + 随机盐值哈希存储
  - 不会明文保存密码

### 2. 密码验证
- **触发场景**: 点击钱包列表中的锁图标 🔒 查看详情时
- **验证流程**:
  1. 点击钱包卡片右侧的锁图标
  2. 如未设置密码，会提示先设置密码
  3. 已设置密码则弹出密码输入框
  4. 输入正确密码后显示钱包详情

### 3. 钱包详情查看
- **显示内容**:
  - ✅ 钱包名称
  - ✅ 钱包类型（热钱包/冷钱包/观察钱包）
  - ✅ 区块链和网络
  - ✅ 钱包地址（可复制）
  - ✅ 公钥（可复制）
  - 🔒 私钥（默认隐藏，点击显示/隐藏，可复制）
  - 🔒 助记词（默认隐藏，点击显示/隐藏，可复制）
  - ✅ 创建时间

- **操作按钮**:
  - 👁️ 显示/隐藏私钥
  - 👁️ 显示/隐藏助记词
  - 📋 一键复制各项信息
  - 🗑️ 删除钱包（需要二次确认）

### 4. 本地存储
- **存储位置**: localStorage
- **加密方式**:
  - 私钥: Base64 + 字符串反转（简单混淆）
  - 密码: SHA-256 + 随机盐值
  - 数据加密: AES-GCM（通过 PasswordService）
- **持久化**:
  - 创建钱包后自动保存
  - 导入钱包后自动保存
  - 应用启动时自动加载

## 使用流程

### 首次使用
1. 打开应用，创建或导入钱包
2. 点击右上角"设置"按钮
3. 在"密码设置"区域点击"设置密码"
4. 输入密码（至少6位）并确认
5. 密码设置成功

### 查看钱包详情
1. 在钱包列表中，点击任意钱包卡片右侧的锁图标 🔒
2. 如果未设置密码，会提示先设置
3. 输入密码验证
4. 验证成功后显示完整钱包信息
5. 可以查看/复制私钥和助记词

### 修改密码
1. 打开设置
2. 点击"修改密码"
3. 输入新密码并确认
4. 密码修改成功

## 安全提示

⚠️ **重要安全建议**:

1. **密码安全**:
   - 请使用强密码（建议8位以上，包含字母、数字、符号）
   - 不要使用生日、电话等容易猜测的密码
   - 定期更换密码

2. **私钥保护**:
   - 查看私钥时确保周围没有他人
   - 不要截图或拍照私钥
   - 不要通过网络传输私钥
   - 复制私钥后请及时清空剪贴板

3. **助记词备份**:
   - 务必离线备份助记词（手写在纸上）
   - 将备份保存在安全的地方
   - 不要将助记词保存在联网设备上
   - 丢失助记词和密码将无法恢复钱包

4. **删除钱包**:
   - 删除前请确保已备份私钥或助记词
   - 删除操作不可逆

## 技术实现

### 后端服务

#### WalletStorage 类
```typescript
// 钱包数据持久化
- saveWallets(wallets): 保存钱包列表
- loadWallets(): 加载钱包列表
- addWallet(wallet): 添加钱包
- deleteWallet(id): 删除钱包
- updateWallet(id, updates): 更新钱包
```

#### PasswordService 类
```typescript
// 密码管理和加密
- setPassword(password): 设置密码
- verifyPassword(password): 验证密码
- hasPassword(): 检查是否已设置密码
- changePassword(oldPassword, newPassword): 修改密码
- resetPassword(): 重置密码
- encryptData(data, password): AES-GCM 加密
- decryptData(encrypted, password): AES-GCM 解密
```

### 加密算法
- **密码哈希**: SHA-256 + 16字节随机盐值
- **密钥派生**: PBKDF2（100000次迭代）
- **数据加密**: AES-GCM（256-bit）

### 存储键
- `xwallet_wallets`: 钱包列表
- `xwallet_password_hash`: 密码哈希值
- `xwallet_password_salt`: 密码盐值

## UI 组件

### 1. 设置密码对话框
- 输入新密码
- 确认密码
- 密码强度提示

### 2. 密码验证对话框
- 输入密码
- 支持回车键提交
- 错误提示

### 3. 钱包详情对话框
- 完整钱包信息展示
- 私钥/助记词显示/隐藏切换
- 一键复制功能
- 删除钱包功能

## 键盘快捷键

- **密码验证**: `Enter` 键提交

## 图标说明

- 🔒 Lock: 锁定/需要密码
- 👁️ Eye: 显示敏感信息
- 🙈 EyeOff: 隐藏敏感信息
- 📋 Clipboard: 复制
- 🗑️ Trash: 删除

## 未来改进

- [ ] 支持生物识别（指纹/面容）
- [ ] 密码找回功能
- [ ] 密码强度检测
- [ ] 自动锁定功能
- [ ] 密码输入失败次数限制
- [ ] 更强的加密算法选项

## 常见问题

**Q: 忘记密码怎么办？**
A: 密码无法找回。建议使用助记词或私钥重新导入钱包。

**Q: 密码存储在哪里？**
A: 密码经过 SHA-256 哈希后存储在浏览器的 localStorage 中，不会明文保存。

**Q: 可以不设置密码吗？**
A: 可以。但不设置密码无法查看私钥和助记词详情。

**Q: 密码可以为空吗？**
A: 不可以。密码至少需要6位字符。

**Q: 删除钱包后密码还在吗？**
A: 密码独立于钱包，删除钱包不会删除密码。

## 版本历史

- **v1.0.0** (2024-01): 初始版本
  - 实现密码设置功能
  - 实现密码验证功能
  - 实现钱包详情查看
  - 实现本地持久化存储
