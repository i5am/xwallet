# 二维码扫描功能快速使用指南

## 🚀 快速开始

### 1. 启动应用

```powershell
cd d:\projects\wdk
npm run dev
```

应用将在 http://localhost:5173 或 http://localhost:5174 启动

### 2. 创建或选择钱包

- 点击"创建"按钮创建新钱包
- 或导入现有钱包
- 选择一个钱包（点击钱包卡片）

### 3. 使用扫描功能

点击"扫描二维码"按钮（蓝色按钮，带摄像头图标）

## 📱 测试步骤

### 方法 1: 使用 HTML 工具（推荐）

1. **打开二维码生成器**
   ```
   用浏览器打开: d:\projects\wdk\tools\qr-generator.html
   ```

2. **生成测试二维码**
   - 选择类型：消息签名/交易签名/授权请求
   - 使用示例数据或自定义
   - 点击"生成二维码"

3. **用钱包扫描**
   - 在钱包应用中点击"扫描二维码"
   - 将摄像头对准生成的二维码
   - 等待自动识别

4. **确认和签名**
   - 查看详细信息
   - 确认无误后点击签名按钮
   - 查看生成的签名二维码

### 方法 2: 使用另一台设备

1. **在设备 A 上**：打开 `tools/qr-generator.html`
2. **在设备 B 上**：打开钱包应用
3. **设备 B 扫描设备 A** 显示的二维码

### 方法 3: 打印二维码

1. 生成二维码并打印
2. 用钱包应用扫描打印的二维码

## 🎯 测试场景

### 场景 1: 消息签名

**用途**: 身份验证、登录确认

**步骤**:
1. 在二维码生成器中选择"消息签名"
2. 点击"登录验证"示例
3. 生成二维码
4. 用钱包扫描
5. 查看消息内容和请求者地址
6. 点击"✍️ 确认签名"
7. 查看生成的签名二维码

**数据示例**:
```json
{
  "type": "message",
  "message": "Login verification for example.com\nTimestamp: 1729411200000",
  "address": "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb",
  "timestamp": 1729411200000
}
```

### 场景 2: BTC 交易签名

**用途**: 冷钱包离线签名

**步骤**:
1. 在二维码生成器中选择"交易签名"
2. 点击"BTC 转账"示例
3. 生成二维码
4. 用钱包扫描
5. **仔细查看**:
   - 收款地址
   - 转账金额
   - 手续费
6. 确认无误后点击"💸 确认签名交易"
7. 查看生成的签名交易二维码

**数据示例**:
```json
{
  "type": "transaction",
  "to": "bc1p5cyxnuxmeuwuvkwfem96lqzszd02n6xdcjrs20cac6yqjjwudpxqkedrcr",
  "amount": "0.001",
  "chain": "BTC",
  "fee": "0.00001"
}
```

### 场景 3: ETH 交易签名

**步骤**:
1. 在二维码生成器中选择"交易签名"
2. 点击"ETH 转账"示例
3. 生成二维码
4. 用钱包扫描
5. 查看交易详情
6. 确认签名

**数据示例**:
```json
{
  "type": "transaction",
  "to": "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb",
  "amount": "0.1",
  "chain": "ETH",
  "data": "0x"
}
```

### 场景 4: DApp 授权

**用途**: 授权 DApp 访问钱包

**步骤**:
1. 在二维码生成器中选择"授权请求"
2. 点击"基础授权"示例
3. 生成二维码
4. 用钱包扫描
5. **查看授权范围**:
   - 读取地址
   - 签名消息
   - 等权限
6. 确认后点击"🔐 确认授权"
7. 查看生成的授权令牌二维码

**数据示例**:
```json
{
  "type": "authorization",
  "domain": "app.example.com",
  "scope": ["read_address", "sign_message"],
  "expiresIn": 3600
}
```

## 📋 确认界面说明

### 消息签名确认

界面元素:
- ⚠️ **警告提示** (黄色): 提醒用户仔细确认
- **消息内容**: 完整显示需要签名的文本
- **请求者地址**: 谁请求的签名
- **时间戳**: 请求时间
- **签名钱包**: 使用哪个钱包签名
- **按钮**: 
  - 灰色"取消" - 拒绝签名
  - 蓝色"✍️ 确认签名" - 执行签名

### 交易签名确认

界面元素:
- ⚠️ **警告提示** (红色): 强调交易风险
- **收款地址**: 完整地址（等宽字体）
- **转账金额**: 大号蓝色高亮显示
- **区块链类型**: BTC 或 ETH
- **手续费**: 如果提供
- **交易数据**: 合约调用数据（如果有）
- **签名钱包**: 使用哪个钱包
- **按钮**:
  - 灰色"取消" - 拒绝签名
  - 红色"💸 确认签名交易" - 执行签名

### 授权确认

界面元素:
- 🔐 **提示** (紫色): 授权说明
- **请求域名**: 哪个网站请求授权
- **授权范围**: 列表显示所有权限
- **有效期**: 授权多久有效
- **授权钱包**: 使用哪个钱包
- **按钮**:
  - 灰色"拒绝" - 拒绝授权
  - 紫色"🔐 确认授权" - 执行授权

## ⚠️ 安全检查

在签名前，系统会自动检查：

### 1. 钱包类型检查
```
❌ 观测钱包无法签名，请使用热钱包或冷钱包
```
观测钱包只能查看，不能签名。

### 2. 私钥检查
```
❌ 钱包缺少私钥，无法签名
```
钱包必须有私钥才能签名。

### 3. 交易数据检查
```
❌ 交易数据不完整，缺少收款地址或金额
```
交易必须包含收款地址和金额。

### 4. 链类型检查
```
❌ 链类型不匹配
交易链: BTC
钱包链: ETH
```
只能在对应的链上签名交易。

## 📊 签名结果

### 成功提示

签名成功后会显示详细信息：

**消息签名成功**:
```
✅ 消息签名成功！

消息: Welcome to our DApp! Please sign this...
签名者: bc1p5cy...drcr
链: BTC

已生成签名二维码，请使用在线钱包扫描验证。
```

**交易签名成功**:
```
✅ 交易签名成功！

收款地址: bc1p5cy...drcr
金额: 0.001
链: BTC
签名者: bc1p7xy...abc

已生成签名交易二维码，请使用在线钱包扫描并广播。
```

**授权成功**:
```
✅ 授权成功！

域名: app.example.com
权限: read_address, sign_message
授权地址: bc1p5cy...drcr

已生成授权二维码，请使用应用扫描完成授权。
```

### 签名结果二维码

签名成功后会生成包含完整签名信息的二维码：

- 蓝色边框高亮显示
- 包含签名数据
- 包含签名者地址
- 包含时间戳
- 版本信息

在线钱包扫描此二维码后可以：
- 验证签名
- 广播交易
- 验证授权

## 🔄 继续操作

签名完成后有两个选项：

1. **继续扫描** - 扫描下一个二维码
2. **关闭** - 关闭扫描对话框

## 💡 使用技巧

### 1. 光线充足
确保在光线充足的环境下扫描，提高识别速度。

### 2. 保持稳定
将摄像头对准二维码，保持稳定几秒钟。

### 3. 距离适中
保持适当距离，让二维码充满扫描框。

### 4. 查看完整信息
签名前务必查看所有详细信息，特别是金额和地址。

### 5. 验证域名
授权时务必验证请求域名是否是信任的网站。

## 🐛 常见问题

### Q1: 摄像头无法启动？

**A**: 检查浏览器权限设置，确保允许访问摄像头。

### Q2: 二维码无法识别？

**A**: 
- 确保二维码清晰完整
- 调整光线和距离
- 尝试不同角度

### Q3: 显示"观测钱包无法签名"？

**A**: 选择热钱包或冷钱包，观测钱包只能查看不能签名。

### Q4: 链类型不匹配？

**A**: 确保交易的链类型与钱包的链类型一致（BTC 钱包签 BTC 交易，ETH 钱包签 ETH 交易）。

### Q5: 如何验证签名结果？

**A**: 用在线钱包扫描生成的签名二维码，它包含完整的签名信息可供验证。

## 📚 更多资源

- [完整功能文档](QR_SCANNING_FEATURE.md)
- [确认流程详解](SCAN_CONFIRMATION_FLOW.md)
- [更新总结](SCAN_UPDATE_SUMMARY.md)
- [测试示例](QR_CODE_EXAMPLES.md)

## 🎉 开始使用

现在你已经了解了如何使用二维码扫描功能，快去试试吧！

1. 启动应用: `npm run dev`
2. 打开二维码生成器: `tools/qr-generator.html`
3. 开始扫描和签名！

祝你使用愉快！🎊
