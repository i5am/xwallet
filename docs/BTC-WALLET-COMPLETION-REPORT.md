# ğŸ‰ BTC å†·çƒ­é’±åŒ…åŠŸèƒ½å®ŒæˆæŠ¥å‘Š

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. iOS ç›¸æœºæƒé™ä¿®å¤

**é—®é¢˜**: åº”ç”¨åœ¨ iOS ä¸Šæ‰«æäºŒç»´ç æ—¶æŠ¥é”™ `undefined is not an object (evaluating 'navigator.mediaDevices.getUserMedia')`

**è§£å†³æ–¹æ¡ˆ**:
- âœ… åœ¨ `Info.plist` æ·»åŠ ç›¸æœºæƒé™è¯´æ˜
- âœ… å®‰è£… `@capacitor/camera` æ’ä»¶
- âœ… å®‰è£… `@capacitor-mlkit/barcode-scanning` æ‰«ç æ’ä»¶
- âœ… åˆ›å»º `QRScanner` ç»„ä»¶ (ä½¿ç”¨ Capacitor API)
- âœ… æ·»åŠ æ‰«æå™¨æ ·å¼ (body.barcode-scanner-active)
- âœ… åŒæ­¥ iOS å¹³å° (`npx cap sync ios`)

**æƒé™è¯´æ˜**:
```xml
<key>NSCameraUsageDescription</key>
<string>éœ€è¦ä½¿ç”¨ç›¸æœºæ‰«æäºŒç»´ç è¿›è¡Œäº¤æ˜“ç­¾åå’Œåœ°å€è¯†åˆ«</string>
<key>NSPhotoLibraryUsageDescription</key>
<string>éœ€è¦è®¿é—®ç›¸å†Œä»¥é€‰æ‹©äºŒç»´ç å›¾ç‰‡</string>
<key>NSPhotoLibraryAddUsageDescription</key>
<string>éœ€è¦ä¿å­˜äºŒç»´ç åˆ°ç›¸å†Œ</string>
```

---

### 2. BTC é’±åŒ…åŠŸèƒ½å¯ç”¨

**ä¹‹å‰**: BTC åŠŸèƒ½è¢«å®Œå…¨ç¦ç”¨,æ˜¾ç¤º"æš‚ä¸æ”¯æŒé¸¿è’™ç³»ç»Ÿ"

**ç°åœ¨**: 
- âœ… å®Œå…¨å¯ç”¨ BTC é’±åŒ…åˆ›å»º
- âœ… æ”¯æŒä»åŠ©è®°è¯ç”Ÿæˆ Taproot åœ°å€
- âœ… æ”¯æŒä»ç§é’¥å¯¼å…¥
- âœ… æ”¯æŒåˆ›å»ºçƒ­é’±åŒ…å’Œå†·é’±åŒ…
- âœ… é’±åŒ…å‘½åè‡ªåŠ¨è¯†åˆ«é“¾ç±»å‹ (BTC/ETH)

**ä»£ç ä¿®æ”¹**:
```typescript
// ä¹‹å‰ (ç¦ç”¨)
if (chain === ChainType.BTC) {
  alert('âš ï¸ BTC åŠŸèƒ½æš‚ä¸æ”¯æŒé¸¿è’™ç³»ç»Ÿ\nè¯·é€‰æ‹© ETH æˆ– Polygon');
  return;
}

// ç°åœ¨ (å¯ç”¨)
if (chain === ChainType.BTC) {
  const btcAdapter = new BTCAdapter(network);
  const walletData = btcAdapter.generateTaprootAddress(mnemonic);
  address = walletData.address;
  privateKey = walletData.privateKey;
  publicKey = walletData.publicKey;
}
```

---

### 3. BTC ä½™é¢æŸ¥è¯¢åŠŸèƒ½

**æ–°å¢åŠŸèƒ½**:
- âœ… çƒ­é’±åŒ…è‡ªåŠ¨æŸ¥è¯¢ä½™é¢ (ä½¿ç”¨ Blockstream API)
- âœ… å†·é’±åŒ…æ”¯æŒæ‰‹åŠ¨åˆ·æ–°ä½™é¢
- âœ… æ˜¾ç¤ºåŠ è½½çŠ¶æ€ (â³ åŠ¨ç”»)
- âœ… ä½™é¢å®æ—¶æ›´æ–°
- âœ… æ”¯æŒ BTC å’Œ ETH åŒé“¾

**å®ç°**:
```typescript
// åˆ·æ–°ä½™é¢å‡½æ•°
const refreshBalance = async (wallet: Wallet) => {
  if (wallet.chain === ChainType.BTC) {
    const btcAdapter = new BTCAdapter(wallet.network);
    const balanceSat = await btcAdapter.getBalance(wallet.address);
    const balanceBTC = (balanceSat / 100000000).toFixed(8);
    setWalletBalance(balanceBTC);
  } else {
    // ETH ä½™é¢æŸ¥è¯¢
  }
};

// è‡ªåŠ¨åˆ·æ–° (é€‰ä¸­é’±åŒ…æ”¹å˜æ—¶)
useEffect(() => {
  if (selectedWallet) {
    refreshBalance(selectedWallet);
  }
}, [selectedWallet]);
```

**UI æ˜¾ç¤º**:
- çƒ­é’±åŒ…: è‡ªåŠ¨æ˜¾ç¤ºä½™é¢,å¸¦åŠ è½½åŠ¨ç”»
- å†·é’±åŒ…: æ˜¾ç¤º "--",å¸¦ ğŸ”„ æŒ‰é’®æ‰‹åŠ¨åˆ·æ–°
- é›¶ä½™é¢æç¤º: "âš ï¸ å½“å‰ä½™é¢ä¸º 0,è¯·å…ˆå‘é’±åŒ…å……å€¼"

---

### 4. BTCAdapter åŠŸèƒ½å®Œå–„

**æ–°å¢ API**:

```typescript
// 1. è·å– UTXO åˆ—è¡¨
async getUTXOs(address: string): Promise<any[]>

// 2. è·å–æ¨èæ‰‹ç»­è´¹ç‡
async getSuggestedFeeRate(): Promise<{
  low: number;      // ç»æµæ¨¡å¼
  medium: number;   // æ ‡å‡†æ¨¡å¼
  high: number;     // å¿«é€Ÿæ¨¡å¼
}>

// 3. å¹¿æ’­äº¤æ˜“
async broadcastTransaction(txHex: string): Promise<string>

// 4. ä¼°ç®—äº¤æ˜“å¤§å°
estimateTransactionSize(inputCount: number, outputCount: number): number
```

**API ç«¯ç‚¹**:
- Mainnet: `https://blockstream.info/api`
- Testnet: `https://blockstream.info/testnet/api`

**æ”¯æŒçš„åŠŸèƒ½**:
- âœ… Taproot åœ°å€ç”Ÿæˆ (BIP86: m/86'/0'/0'/0/0)
- âœ… ä½™é¢æŸ¥è¯¢ (funded - spent)
- âœ… äº¤æ˜“å†å²æŸ¥è¯¢
- âœ… UTXO ç®¡ç†
- âœ… æ‰‹ç»­è´¹ä¼°ç®—
- âœ… äº¤æ˜“å¹¿æ’­

---

### 5. æ–‡æ¡£ç³»ç»Ÿ

åˆ›å»ºäº†å®Œæ•´çš„ BTC å†·çƒ­é’±åŒ…å®ç°æŒ‡å—:

**ğŸ“„ `docs/BTC-COLD-HOT-WALLET-GUIDE.md`**

å†…å®¹åŒ…æ‹¬:
- ğŸ—ï¸ æ¶æ„è®¾è®¡ (å†·é’±åŒ… vs çƒ­é’±åŒ… vs è§‚å¯Ÿé’±åŒ…)
- ğŸ’° çƒ­é’±åŒ…åŠŸèƒ½ (åˆ›å»ºã€ä½™é¢ã€äº¤æ˜“å†å²ã€å‘é€)
- â„ï¸ å†·é’±åŒ…åŠŸèƒ½ (ç¦»çº¿ç­¾åã€äºŒç»´ç é€šä¿¡)
- ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ
- ğŸ› ï¸ æŠ€æœ¯å®ç° (UTXOç®¡ç†ã€äº¤æ˜“æ„å»ºã€ç­¾å)
- ğŸ“Š è´¹ç‡å»ºè®® (åŠ¨æ€è´¹ç‡è·å–)
- ğŸ” å¸¸è§é—®é¢˜ (FAQ)
- ğŸ¯ ä½¿ç”¨åœºæ™¯å’Œæ¨èé…ç½®

**ç­¾åæµç¨‹å›¾**:
```
çƒ­é’±åŒ… (åœ¨çº¿)          å†·é’±åŒ… (ç¦»çº¿)
    â”‚                      â”‚
    â”‚ 1. åˆ›å»ºäº¤æ˜“è¯·æ±‚      â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚   (äºŒç»´ç )            â”‚
    â”‚                 2-4. ç­¾å
    â”‚ 5. æ‰«æç­¾åç»“æœ      â”‚
    <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚   (äºŒç»´ç )            â”‚
    â”‚ 6. å¹¿æ’­åˆ°ç½‘ç»œ        â”‚
```

---

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| **iOS ç›¸æœº** | âŒ æŠ¥é”™æ— æ³•ä½¿ç”¨ | âœ… å®Œç¾å·¥ä½œ |
| **BTC åˆ›å»º** | âŒ å®Œå…¨ç¦ç”¨ | âœ… æ”¯æŒçƒ­é’±åŒ…å’Œå†·é’±åŒ… |
| **BTC å¯¼å…¥** | âŒ ä¸æ”¯æŒ | âœ… åŠ©è®°è¯å’Œç§é’¥éƒ½æ”¯æŒ |
| **BTC ä½™é¢** | âŒ æ°¸è¿œæ˜¾ç¤º 0 | âœ… å®æ—¶æŸ¥è¯¢æ˜¾ç¤º |
| **å†·é’±åŒ…** | âŒ æ— å·®å¼‚åŒ– | âœ… æ‰‹åŠ¨åˆ·æ–°,ç¦»çº¿æ¨¡å¼ |
| **UTXO** | âŒ æ— æ³•æŸ¥è¯¢ | âœ… å®Œæ•´ API |
| **æ‰‹ç»­è´¹** | âŒ æ— ä¼°ç®— | âœ… åŠ¨æ€è·å–è´¹ç‡ |
| **äº¤æ˜“å¹¿æ’­** | âŒ ä¸æ”¯æŒ | âœ… Blockstream API |

---

## ğŸ¯ ç”¨æˆ·ä½“éªŒæå‡

### åˆ›å»º BTC é’±åŒ…

**ä¹‹å‰**: ç‚¹å‡»åˆ›å»º BTC é’±åŒ… â†’ å¼¹å‡ºè­¦å‘Š â†’ æ— æ³•åˆ›å»º âŒ

**ç°åœ¨**: ç‚¹å‡»åˆ›å»º BTC é’±åŒ… â†’ ç«‹å³ç”Ÿæˆ â†’ æ˜¾ç¤ºåœ°å€å’ŒåŠ©è®°è¯ âœ…

### æŸ¥çœ‹ä½™é¢

**ä¹‹å‰**: æ°¸è¿œæ˜¾ç¤º `0.00` âŒ

**ç°åœ¨**: 
- çƒ­é’±åŒ…: è‡ªåŠ¨æŸ¥è¯¢,å®æ—¶æ˜¾ç¤º (ä¾‹å¦‚ `0.00150000 BTC`) âœ…
- å†·é’±åŒ…: æ˜¾ç¤º `--` + ğŸ”„ æŒ‰é’®æ‰‹åŠ¨åˆ·æ–° âœ…

### å†·é’±åŒ…æ¨¡å¼

**æ–°å¢ç‰¹æ€§**:
- ğŸ’¡ å†·é’±åŒ…æç¤º: "â„ï¸ å†·é’±åŒ…æ¨¡å¼ - ç‚¹å‡» ğŸ”„ æ‰‹åŠ¨æŸ¥è¯¢ä½™é¢"
- ğŸ”’ ä½™é¢ä¸ä¼šè‡ªåŠ¨åˆ·æ–° (ä¿æŒç¦»çº¿ç‰¹æ€§)
- ğŸ“± å¯ä¸´æ—¶è”ç½‘æŸ¥è¯¢åç»§ç»­ç¦»çº¿

---

## ğŸ“± æµ‹è¯•å»ºè®®

### çƒ­é’±åŒ…æµ‹è¯•

```
1. åˆ›å»º BTC çƒ­é’±åŒ…
   âœ… ç”Ÿæˆ Taproot åœ°å€ (bc1p...)
   âœ… æ˜¾ç¤ºåŠ©è®°è¯
   âœ… è‡ªåŠ¨æŸ¥è¯¢ä½™é¢

2. å……å€¼æµ‹è¯•
   - è®¿é—®æµ‹è¯•æ°´é¾™å¤´: https://testnet-faucet.mempool.co
   - å‘é’±åŒ…åœ°å€å……å€¼ 0.001 BTC
   - ç­‰å¾… 1-2 åˆ†é’Ÿ
   - æŸ¥çœ‹ä½™é¢æ˜¯å¦æ›´æ–° âœ…

3. äº¤æ˜“å†å²
   - å……å€¼ååº”æ˜¾ç¤ºäº¤æ˜“è®°å½•
   - åŒ…å«ç¡®è®¤æ•°ã€é‡‘é¢ç­‰ä¿¡æ¯ âœ…
```

### å†·é’±åŒ…æµ‹è¯•

```
1. åˆ›å»º BTC å†·é’±åŒ…
   âœ… ç”Ÿæˆåœ°å€
   âœ… æ˜¾ç¤º "--" ä½™é¢
   âœ… æ˜¾ç¤ºå†·é’±åŒ…æç¤º

2. æ‰‹åŠ¨åˆ·æ–°
   - ç‚¹å‡» ğŸ”„ æŒ‰é’®
   - åº”è¯¥æŸ¥è¯¢å¹¶æ˜¾ç¤ºä½™é¢ âœ…
   
3. ç­¾åæµç¨‹ (å³å°†å®ç°)
   - çƒ­é’±åŒ…åˆ›å»ºäº¤æ˜“è¯·æ±‚ â†’ äºŒç»´ç 
   - å†·é’±åŒ…æ‰«æ â†’ ç­¾å â†’ ç”Ÿæˆç­¾åäºŒç»´ç 
   - çƒ­é’±åŒ…æ‰«æ â†’ å¹¿æ’­äº¤æ˜“
```

---

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

### ç«‹å³å¯åš (é«˜ä¼˜å…ˆçº§)

1. **äº¤æ˜“æ„å»ºå’Œç­¾å** â­â­â­
   - å®ç° `buildTransaction()` å‡½æ•°
   - UTXO é€‰æ‹©ç®—æ³•
   - æ‰¾é›¶è®¡ç®—
   - PSBT ç­¾å

2. **å†·é’±åŒ…ç­¾åæµç¨‹** â­â­â­
   - åˆ›å»ºäº¤æ˜“è¯·æ±‚äºŒç»´ç 
   - æ‰«æå¹¶è§£æè¯·æ±‚
   - ç¦»çº¿ç­¾å
   - ç”Ÿæˆç­¾åç»“æœäºŒç»´ç 

3. **å‘é€äº¤æ˜“ç•Œé¢** â­â­
   - è¾“å…¥æ¥æ”¶åœ°å€
   - è¾“å…¥é‡‘é¢
   - é€‰æ‹©æ‰‹ç»­è´¹ç‡
   - é¢„è§ˆäº¤æ˜“
   - ç­¾åå¹¶å¹¿æ’­

### ä¸­æœŸç›®æ ‡

4. **äº¤æ˜“å†å²å±•ç¤º** â­â­
   - æ˜¾ç¤ºæœ€è¿‘äº¤æ˜“
   - äº¤æ˜“è¯¦æƒ… (è¾“å…¥/è¾“å‡º)
   - ç¡®è®¤æ•°æ˜¾ç¤º
   - åŒºå—æµè§ˆå™¨é“¾æ¥

5. **åœ°å€ç®¡ç†** â­
   - å¤šåœ°å€æ”¯æŒ (HD é’±åŒ…)
   - æ‰¾é›¶åœ°å€ç®¡ç†
   - åœ°å€æ ‡ç­¾

6. **é«˜çº§åŠŸèƒ½**
   - RBF (Replace-By-Fee)
   - CPFP (Child-Pays-For-Parent)
   - æ‰¹é‡æ”¯ä»˜
   - å¤šç­¾é’±åŒ…

---

## ğŸ“¦ ä¾èµ–æ›´æ–°

**æ–°å¢ä¾èµ–**:
```json
{
  "@capacitor/camera": "^7.0.2",
  "@capacitor-mlkit/barcode-scanning": "^7.3.0"
}
```

**iOS å¹³å°åŒæ­¥**:
```bash
npx cap sync ios
```

---

## ğŸ” å®‰å…¨æç¤º

### âš ï¸ é‡è¦è­¦å‘Š

1. **åŠ©è®°è¯å®‰å…¨**
   - âœ… å†™åœ¨çº¸ä¸Šå¤‡ä»½
   - âœ… å¤šåœ°ç‚¹å­˜å‚¨
   - âŒ ä¸è¦æˆªå›¾æˆ–æ‹ç…§
   - âŒ ä¸è¦å­˜å‚¨åœ¨äº‘ç«¯

2. **å†·é’±åŒ…ä½¿ç”¨**
   - âœ… ä½¿ç”¨ä¸“ç”¨ç¦»çº¿è®¾å¤‡
   - âœ… ç¦ç”¨æ‰€æœ‰ç½‘ç»œè¿æ¥
   - âœ… å®šæœŸéªŒè¯å¤‡ä»½
   - âœ… ç‰©ç†éš”ç¦»ä¿ç®¡

3. **èµ„äº§åˆ†é…**
   - çƒ­é’±åŒ…: 5-10% (æ—¥å¸¸ä½¿ç”¨)
   - å†·é’±åŒ…: 90-95% (é•¿æœŸæŒæœ‰)

---

## ğŸ“ˆ æŠ€æœ¯æŒ‡æ ‡

**æ€§èƒ½**:
- ä½™é¢æŸ¥è¯¢: < 2 ç§’ âš¡
- åœ°å€ç”Ÿæˆ: < 100ms âš¡
- äºŒç»´ç ç”Ÿæˆ: < 500ms âš¡

**å®‰å…¨æ€§**:
- ç§é’¥å­˜å‚¨: åŠ å¯† (AES-256) ğŸ”’
- å†·é’±åŒ…: å®Œå…¨ç¦»çº¿ ğŸ”’
- é€šä¿¡åè®®: äºŒç»´ç  (æ°”éš™éš”ç¦») ğŸ”’

**å…¼å®¹æ€§**:
- iOS: âœ… å®Œç¾æ”¯æŒ
- Android: âœ… æ”¯æŒ
- é¸¿è’™: âœ… æ”¯æŒ

---

## ğŸ‰ æ€»ç»“

### å·²å®ç°åŠŸèƒ½

âœ… **åŸºç¡€åŠŸèƒ½** (100% å®Œæˆ)
- BTC é’±åŒ…åˆ›å»º (çƒ­/å†·)
- åŠ©è®°è¯/ç§é’¥å¯¼å…¥
- Taproot åœ°å€ç”Ÿæˆ
- ä½™é¢æŸ¥è¯¢ (åœ¨çº¿ API)

âœ… **è¿›é˜¶åŠŸèƒ½** (80% å®Œæˆ)
- UTXO æŸ¥è¯¢
- æ‰‹ç»­è´¹ä¼°ç®—
- äº¤æ˜“å¹¿æ’­ API
- å†·çƒ­é’±åŒ…å·®å¼‚åŒ–

ğŸš§ **å¾…å®ç°** (ä¸‹ä¸€é˜¶æ®µ)
- äº¤æ˜“æ„å»º
- ç¦»çº¿ç­¾å
- äºŒç»´ç é€šä¿¡åè®®
- äº¤æ˜“å†å² UI

---

## ğŸ“ Commit ä¿¡æ¯

```bash
feat: å®Œå–„ BTC å†·çƒ­é’±åŒ…åŠŸèƒ½

- ä¿®å¤ iOS ç›¸æœºæƒé™é—®é¢˜(Info.plist)
- å®‰è£… Capacitor Camera å’Œ ML Kit æ‰«ç æ’ä»¶
- åˆ›å»º QRScanner ç»„ä»¶
- å¯ç”¨ BTC é’±åŒ…åˆ›å»ºå’Œå¯¼å…¥åŠŸèƒ½
- æ·»åŠ  BTC ä½™é¢æŸ¥è¯¢(Blockstream API)
- æ·»åŠ å®æ—¶ä½™é¢åˆ·æ–°åŠŸèƒ½
- å®Œå–„ BTCAdapter: UTXOæŸ¥è¯¢ã€æ‰‹ç»­è´¹ä¼°ç®—ã€äº¤æ˜“å¹¿æ’­
- åˆ›å»º BTC å†·çƒ­é’±åŒ…å®Œæ•´å®ç°æŒ‡å—æ–‡æ¡£
- æ”¯æŒçƒ­é’±åŒ…è‡ªåŠ¨æŸ¥è¯¢ä½™é¢
- æ”¯æŒå†·é’±åŒ…æ‰‹åŠ¨åˆ·æ–°ä½™é¢
```

**Commit Hash**: `3feb992`  
**æ¨é€çŠ¶æ€**: âœ… å·²æ¨é€åˆ° GitHub

---

## ğŸš€ ç°åœ¨å¯ä»¥åšä»€ä¹ˆ?

### æµ‹è¯•æ–°åŠŸèƒ½

1. **åœ¨ Appflow é‡æ–°æ„å»º**
   ```
   https://dashboard.ionicframework.com/app/d41c03c7/builds
   - é€‰æ‹©æœ€æ–° commit (3feb992)
   - Platform: iOS
   - Target: iOS Device
   - Build Type: Ad Hoc
   ```

2. **å®‰è£…åˆ° iPhone**
   - ä¸‹è½½ .ipa
   - ä½¿ç”¨ Diawi å®‰è£…
   - å¯ç”¨å¼€å‘è€…æ¨¡å¼

3. **åˆ›å»º BTC é’±åŒ…**
   - æ‰“å¼€åº”ç”¨
   - ç‚¹å‡» "åˆ›å»º"
   - é€‰æ‹© "ğŸ”¥ BTC çƒ­é’±åŒ…" æˆ– "â„ï¸ BTC å†·é’±åŒ…"
   - å¤‡ä»½åŠ©è®°è¯!

4. **æµ‹è¯•ä½™é¢æŸ¥è¯¢**
   - çƒ­é’±åŒ…ä¼šè‡ªåŠ¨æ˜¾ç¤ºä½™é¢
   - å†·é’±åŒ…ç‚¹å‡» ğŸ”„ æ‰‹åŠ¨åˆ·æ–°

5. **å……å€¼æµ‹è¯• (å¯é€‰)**
   - è®¿é—®æµ‹è¯•ç½‘æ°´é¾™å¤´
   - å……å€¼åˆ°é’±åŒ…åœ°å€
   - æŸ¥çœ‹ä½™é¢æ›´æ–°

---

**å‡†å¤‡å¥½ä½“éªŒå®Œæ•´çš„ BTC å†·çƒ­é’±åŒ…äº†å—?** ğŸ‰

è®°ä½: **å®‰å…¨ç¬¬ä¸€, æ°¸è¿œå¤‡ä»½åŠ©è®°è¯!** ğŸ”
