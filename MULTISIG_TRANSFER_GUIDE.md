# 🔐 DeepSafe 多签钱包转账签名指南

**版本**: XWallet v1.0.0  
**日期**: 2025-10-31

---

## 📋 目录

1. [快速开始](#快速开始)
2. [创建转账提案](#创建转账提案)
3. [签名流程](#签名流程)
4. [常见问题](#常见问题)

---

## 🚀 快速开始

### 当前钱包信息

根据您的截图，您已创建：
- **钱包名称**: ETH DeepSafe 2-of-3
- **钱包地址**: `0xwtgmuJ16wlb`
- **签名要求**: 2/3（需要 3 个签名者中的 2 个签名）
- **余额**: 0.00 ETH

---

## 📤 创建转账提案

### 步骤 1: 点击"发送"按钮

在钱包详情页面，找到 🔄 **发送** 按钮（钱包名称右侧的操作栏）

### 步骤 2: 填写转账信息

弹出的"发送 ETH"对话框中填写：

```
┌─────────────────────────────────┐
│  发送 ETH                        │
├─────────────────────────────────┤
│                                  │
│  接收地址 *                      │
│  ┌───────────────────────────┐  │
│  │ 0x...                     │  │ ← 填写接收方地址
│  └───────────────────────────┘  │
│                                  │
│  金额 (ETH) *                    │
│  ┌───────────────────────────┐  │
│  │ 0.1                       │  │ ← 填写转账金额
│  └───────────────────────────┘  │
│                                  │
│  手续费 (ETH)                    │
│  ┌───────────────────────────┐  │
│  │ 0.0001                    │  │ ← 自动计算或手动填写
│  └───────────────────────────┘  │
│                                  │
│  备注（可选）                     │
│  ┌───────────────────────────┐  │
│  │                           │  │
│  └───────────────────────────┘  │
│                                  │
│  [取消]  [生成二维码]            │
└─────────────────────────────────┘
```

### 步骤 3: 生成未签名交易

点击 **"生成二维码"** 按钮后，系统会：

1. ✅ 创建未签名交易数据
2. ✅ 生成交易二维码
3. ✅ 显示交易详情确认对话框

**未签名交易数据结构**:
```json
{
  "protocol": "WDK",
  "version": "1.0",
  "type": "UNSIGNED_TX",
  "data": {
    "from": "0xwtgmuJ16wlb",
    "to": "0x接收方地址",
    "amount": "0.1",
    "fee": "0.0001",
    "chain": "ETH",
    "network": "MAINNET",
    "memo": "备注信息",
    "timestamp": 1698739200000
  }
}
```

---

## ✍️ 签名流程

### 多签钱包签名要求

您的 **2-of-3** 多签钱包需要：
- 总共 3 个签名者
- 至少 2 个签名者同意

### 方案 A: 冷钱包签名（推荐 🔒）

#### 签名者 #1 操作

1. **保存未签名交易二维码**
   - 截图保存或打印二维码

2. **在冷钱包设备上操作**
   - 打开 XWallet 冷钱包应用
   - 点击 📷 **扫描** 按钮
   - 扫描未签名交易二维码

3. **确认并签名**
   - 冷钱包会显示交易详情
   - 确认无误后点击 **"签名"**
   - 冷钱包生成签名数据

4. **导出签名**
   - 冷钱包显示签名二维码
   - 热钱包扫描或截图保存

#### 签名者 #2 操作

重复签名者 #1 的步骤，使用自己的冷钱包签名

### 方案 B: 热钱包签名

#### 签名者 #1 操作

1. **接收交易提案**
   - 通过安全渠道接收交易二维码或数据

2. **在热钱包中签名**
   ```
   📱 打开 XWallet
   → 选择对应的签名者钱包
   → 点击 📷 扫描
   → 扫描未签名交易
   → 确认交易详情
   → 点击 "签名" 按钮
   ```

3. **生成部分签名**
   - 系统自动使用私钥签名
   - 生成包含 1/3 签名的交易

#### 签名者 #2 操作

1. **接收部分签名交易**
   - 扫描签名者 #1 生成的二维码

2. **添加第二个签名**
   ```
   → 确认交易详情
   → 点击 "添加签名" 按钮
   → 系统自动添加签名
   → 现在有 2/3 签名（满足要求✅）
   ```

### 方案 C: CRVA 验证签名（最安全 🛡️）

#### 使用 CRVA 随机验证

```
1️⃣ 创建提案
   → 发送交易信息
   → 生成提案 ID

2️⃣ Ring VRF 选择验证节点
   → 系统随机选取 3 个验证节点
   → 保护签名者隐私

3️⃣ 签名者通过 TEE 签名
   → 签名在可信执行环境中完成
   → 验证节点无法获取私钥

4️⃣ 验证节点确认
   → 至少 2/3 验证节点确认
   → 达成共识

5️⃣ 交易执行
   → 阈值签名聚合
   → 提交到区块链
```

**CRVA 优势**:
- ✅ 隐私保护（Ring VRF 随机选取）
- ✅ 安全性高（TEE 环境）
- ✅ 去中心化验证
- ✅ 防止单点故障

---

## 📡 广播交易

### 当收集到足够签名后

#### 步骤 1: 验证签名数量

```
当前签名: 2/3 ✅
状态: 满足执行条件
```

#### 步骤 2: 聚合签名

如果使用 CRVA：
```javascript
// 系统自动聚合阈值签名
const aggregatedSignature = await aggregateThresholdSignatures(signatures);
```

#### 步骤 3: 广播到区块链

1. **在热钱包中操作**
   ```
   → 点击 "广播交易" 按钮
   → 确认交易详情
   → 系统自动提交到区块链
   ```

2. **获取交易哈希**
   ```
   ✅ 交易已提交！
   
   交易哈希: 0x1234...5678
   区块浏览器: https://etherscan.io/tx/0x1234...5678
   
   预计确认时间: 15 秒
   ```

3. **等待确认**
   - ETH: 通常 12-15 秒（1 个区块）
   - BTC: 通常 10 分钟（1 个区块）

---

## 🖥️ 界面操作指南

### 1. 钱包列表页面

```
┌────────────────────────────────────┐
│ 我的钱包            [+ 导入] [+ 创建] │
├────────────────────────────────────┤
│                                     │
│ ETH DeepSafe 2-of-3                │
│ 0xwtgmu...J16wlb                   │
│ [🗝️] [🔍] [🗑️]                    │
│                    ← 点击钱包查看详情│
└────────────────────────────────────┘
```

### 2. 钱包详情页面

```
┌────────────────────────────────────┐
│ 钱包详情                            │
├────────────────────────────────────┤
│                                     │
│         0.00                        │
│         ETH                         │
│                                     │
│ [查看交易历史]                       │
│                                     │
├────────────────────────────────────┤
│ 地址信息                            │
│                                     │
│ 钱包地址                            │
│ 0xwtgmuJ16wlb                      │
│                                     │
├────────────────────────────────────┤
│ 交易历史                            │
│                                     │
│ 暂无交易记录                        │
│                                     │
└────────────────────────────────────┘
```

### 3. 发送交易按钮位置

在钱包卡片上找到操作按钮：

```
ETH DeepSafe 2-of-3
0xwtgmu...J16wlb
[🗝️ 查看详情] [🔍 扫描] [🗑️ 删除]
                ↑
            点击这里扫描
```

或者在钱包详情页面的操作按钮：

```
[📱 接收] [🔄 发送] [✍️ 签名] [...更多]
            ↑
        点击这里发送
```

---

## ⚠️ 常见问题

### Q1: 为什么我的钱包余额是 0？

**A**: 新创建的钱包需要先充值。您可以：
1. 点击 **"接收"** 按钮获取充值地址
2. 使用其他钱包向该地址转账
3. 等待区块链确认（ETH ~15秒，BTC ~10分钟）

### Q2: 如何充值？

**步骤**:
```
1. 点击钱包卡片
2. 点击 📱 "接收" 按钮
3. 显示钱包地址和二维码
4. 使用其他钱包扫描或复制地址
5. 向该地址转账即可
```

### Q3: 需要几个人签名？

**A**: 根据您的设置 **2-of-3**:
- 总共 3 个签名者
- 需要至少 2 个签名者同意
- 任意 2 个签名即可执行交易

### Q4: 签名顺序重要吗？

**A**: 不重要。可以：
- 签名者 1 + 签名者 2
- 签名者 1 + 签名者 3
- 签名者 2 + 签名者 3

任意组合都可以，只要达到 2 个签名。

### Q5: 签名后如何撤销？

**A**: 
- ⚠️ 签名后无法撤销
- 但如果没有收集到足够签名（2个），交易不会执行
- 可以设置交易过期时间

### Q6: 如何确保安全？

**安全建议**:
1. ✅ 使用冷钱包签名（离线设备）
2. ✅ 仔细核对交易地址和金额
3. ✅ 不要在公共 Wi-Fi 下操作
4. ✅ 备份好助记词和私钥
5. ✅ 启用 CRVA 验证（如果支持）

### Q7: 交易卡住怎么办？

**可能原因**:
1. 手续费设置过低
2. 网络拥堵
3. 签名数量不足

**解决方案**:
- 检查签名状态（是否达到 2/3）
- 检查网络连接
- 适当提高手续费
- 等待网络不繁忙时重试

### Q8: CRVA 验证是什么？

**A**: CRVA (Crypto Ring Verifiable Authentication) 是一种隐私保护的多签方案：

**传统多签**:
```
签名者A → 公开签名 → 所有人可见
签名者B → 公开签名 → 所有人可见
```

**CRVA 多签**:
```
签名者? → Ring VRF 随机选取 → 隐私保护
签名者? → TEE 环境签名 → 安全执行
验证节点 → 阈值签名验证 → 去中心化
```

**优势**:
- 🔒 保护签名者隐私
- 🎲 随机验证节点选取
- 🛡️ TEE 可信执行环境
- ⚖️ 去中心化验证

---

## 📞 技术支持

- **文档**: `CRVA_WALLET_GUIDE.md`
- **GitHub**: https://github.com/i5am/xwallet
- **问题反馈**: GitHub Issues

---

## 🎯 下一步

1. **充值钱包**
   - 向 `0xwtgmuJ16wlb` 转入少量 ETH 测试

2. **测试转账**
   - 创建小额测试交易
   - 练习签名流程

3. **配置其他签名者**
   - 确保所有签名者都有钱包
   - 测试签名协作

4. **启用 CRVA**（如果需要）
   - 连接到 CRVA 验证网络
   - 体验隐私保护签名

---

**祝您使用愉快！** 🎉

有任何问题，请查看 `CRVA_WALLET_GUIDE.md` 获取完整指南。
