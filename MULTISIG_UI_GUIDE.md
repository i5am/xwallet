# 🔐 多签钱包操作指南

**更新时间**: 2025-10-31  
**版本**: XWallet v1.0.0

---

## ✅ 已完成：多签钱包操作界面

您现在在多签钱包详情页面可以看到以下功能按钮了！

### 📋 界面说明

#### 1. **钱包信息卡片**

```
┌─────────────────────────────────────┐
│ 🔐 DeepSafe 多签钱包                 │
│                                     │
│ 2-of-3 多重签名，需要 2 个签名者批准    │
│                                     │
│ ✅ 创建转账提案                      │
│ ✅ 签名待处理提案                    │
│ ✅ CRVA 隐私验证（Ring VRF）         │
│ ✅ 达到阈值后自动执行                │
│                                     │
│ 签名者 (3):                         │
│ 1. 签名者1  [活跃]                  │
│ 2. 签名者2  [活跃]                  │
│ 3. 签名者3  [活跃]                  │
│                                     │
│ ✓ CRVA 验证已启用（5 个验证节点）     │
└─────────────────────────────────────┘
```

#### 2. **操作按钮**

```
┌─────────────┬─────────────┐
│ 📤 创建提案  │ 📥 接收地址  │
└─────────────┴─────────────┘

┌─────────────┬─────────────┐
│ 📋 提案列表  │ 📷 扫描签名  │
└─────────────┴─────────────┘
```

---

## 🚀 使用流程

### 场景 1: 创建转账提案

1. **点击"创建提案"按钮**
   - 进入转账界面
   - 填写接收地址
   - 填写转账金额
   - 添加备注（可选）

2. **生成提案二维码**
   - 系统生成未签名交易
   - 显示二维码供其他签名者扫描
   - 提案自动保存到待签名列表

3. **分享给其他签名者**
   - 其他签名者扫描二维码
   - 或通过其他方式分享提案ID

---

### 场景 2: 签名待处理提案

#### 方式 A: 通过提案列表

1. **点击"提案列表"按钮**
   ```
   待签名提案 (2)
   ├── 提案 #001: 转账 0.5 ETH
   │   └── 已签名: 1/2 (需要1个)
   ├── 提案 #002: 转账 1.0 ETH
   │   └── 已签名: 0/2 (需要2个)
   ```

2. **选择待签名提案**
   - 查看提案详情
   - 验证转账信息
   - 点击"签名"按钮

3. **完成签名**
   - 输入钱包密码
   - 系统自动签名
   - 签名上传到 CRVA 验证网络

#### 方式 B: 扫描二维码签名

1. **点击"扫描签名"按钮**
   - 打开摄像头
   - 扫描提案二维码

2. **查看提案详情**
   ```
   提案详情
   ├── 提案ID: prop_abc123
   ├── 类型: 转账
   ├── 金额: 0.5 ETH
   ├── 收款地址: 0x1234...5678
   ├── 创建者: 签名者1
   └── 已签名: 1/2
   ```

3. **签名并提交**
   - 确认信息无误
   - 点击"批准并签名"
   - 输入密码完成签名

---

### 场景 3: 查看和管理提案

1. **点击"提案列表"按钮**

2. **查看不同状态的提案**
   - **待签名** (红色标签): 等待您的签名
   - **已签名** (黄色标签): 等待其他人签名
   - **已执行** (绿色标签): 已达到阈值并执行
   - **已拒绝** (灰色标签): 被否决的提案

3. **提案操作**
   - 查看详情
   - 添加签名
   - 拒绝提案（如果有权限）
   - 广播交易（达到阈值后）

---

## 🔄 完整的多签转账流程

### 示例：2-of-3 多签钱包转账 0.5 ETH

```
签名者1 (创建者)
    ↓
【创建提案】
    ├─ 接收地址: 0xABCD...1234
    ├─ 金额: 0.5 ETH
    ├─ Gas: 自动估算
    └─ 生成提案二维码
    ↓
【分享给其他签名者】
    ├─ 方式1: 显示二维码
    ├─ 方式2: 发送提案ID
    └─ 方式3: 通过通知
    ↓
签名者2 (扫描签名)
    ↓
【扫描二维码】
    ├─ 查看提案详情
    ├─ 验证金额和地址
    └─ 批准并签名 (签名 1/2)
    ↓
【CRVA 验证】
    ├─ Ring VRF 选取验证节点
    ├─ 验证委员会验证签名
    ├─ 隐私保护（不泄露签名者身份）
    └─ 验证结果上链
    ↓
【签名数检查】
    ├─ 当前签名: 1/2
    ├─ 需要签名: 2
    └─ 状态: 等待更多签名
    ↓
签名者3 (扫描签名)
    ↓
【再次签名】
    ├─ 扫描二维码或从列表选择
    ├─ 验证详情
    └─ 批准并签名 (签名 2/2) ✓
    ↓
【达到阈值】
    ├─ 签名数: 2/2 ✓
    ├─ CRVA 验证通过 ✓
    └─ 自动触发执行
    ↓
【执行交易】
    ├─ 组合所有签名
    ├─ 构建最终交易
    ├─ 广播到区块链
    └─ 等待确认
    ↓
【完成】✅
    ├─ 交易哈希: 0x7890...abcd
    ├─ 状态: 已确认
    └─ 余额已更新
```

---

## 🎯 按钮功能说明

### 1. 📤 创建提案

**作用**: 发起新的转账提案

**流程**:
```
点击按钮
  ↓
填写转账信息
  ├─ 接收地址
  ├─ 转账金额
  ├─ Gas设置
  └─ 备注信息
  ↓
生成提案
  ├─ 创建未签名交易
  ├─ 生成提案ID
  ├─ 显示二维码
  └─ 保存到待签名列表
  ↓
自动添加创建者签名（可选）
  ↓
分享给其他签名者
```

**注意事项**:
- ⚠️ 确认接收地址准确
- ⚠️ 检查转账金额
- ⚠️ 预留足够的 Gas 费用
- 💡 添加备注方便识别

---

### 2. 📥 接收地址

**作用**: 显示多签钱包地址和二维码

**功能**:
- 显示钱包地址
- 生成收款二维码
- 支持复制地址
- 支持分享二维码

**使用场景**:
- 接收他人转账
- 分享钱包地址
- 打印收款码

---

### 3. 📋 提案列表

**作用**: 查看所有提案状态

**显示内容**:
```
提案列表
│
├─ 待签名 (2)
│  ├─ 提案 #001: 0.5 ETH → 0xABC... (1/2)
│  └─ 提案 #003: 1.0 ETH → 0xDEF... (0/2)
│
├─ 已执行 (5)
│  ├─ 提案 #004: 0.3 ETH → 0x123...
│  └─ ...
│
└─ 已拒绝 (1)
   └─ 提案 #002: 10 ETH → 0x456... (风险太高)
```

**操作**:
- 点击查看详情
- 添加签名
- 拒绝提案
- 广播交易

---

### 4. 📷 扫描签名

**作用**: 扫描提案二维码快速签名

**流程**:
```
点击按钮
  ↓
打开摄像头
  ↓
扫描提案二维码
  ↓
解析提案信息
  ↓
显示提案详情
  ├─ 提案ID
  ├─ 转账金额
  ├─ 接收地址
  ├─ 创建时间
  ├─ 已签名数
  └─ 需要签名数
  ↓
验证信息
  ↓
批准并签名
  ├─ 输入密码
  ├─ 生成签名
  └─ 提交到网络
  ↓
CRVA 验证
  ↓
完成
```

**支持格式**:
- 提案二维码
- 签名请求二维码
- 提案ID文本

---

## 🔐 CRVA 验证流程

### 什么是 CRVA？

**CRVA** = Cryptographic Random Verification Agent  
基于 Ring VRF 的隐私验证机制

### 验证流程

```
提案创建/签名
    ↓
【随机选取验证委员会】
    ├─ Ring VRF 算法
    ├─ 不可预测
    ├─ 可验证性
    └─ 选出 N 个验证节点（如 3 个）
    ↓
【委员会验证】
    ├─ 节点1: 验证签名有效性 ✓
    ├─ 节点2: 验证签名有效性 ✓
    └─ 节点3: 验证签名有效性 ✓
    ↓
【共识决策】
    ├─ 2/3 以上节点同意 = 通过
    └─ 少于 2/3 = 拒绝
    ↓
【隐私保护】
    ├─ 环签名隐藏验证者身份
    ├─ TEE 保护敏感数据
    └─ 零知识证明
    ↓
【结果上链】
    └─ 验证证明记录到区块链
```

### CRVA 优势

- 🔒 **隐私保护**: Ring VRF 隐藏验证者身份
- 🎲 **随机性**: 无法预测验证委员会成员
- ✅ **可验证**: 任何人都可验证结果
- 🛡️ **抗攻击**: 分布式验证，难以操纵
- ⚡ **高效**: 并行验证，快速响应

---

## ❓ 常见问题

### Q1: 提案需要多长时间执行？

**A**: 取决于签名速度
- 签名收集: 几分钟到几小时（取决于签名者响应速度）
- CRVA 验证: 通常 10-30 秒
- 区块链确认: 15秒-5分钟（取决于网络）

### Q2: 签名后可以撤销吗？

**A**: 不可以
- 签名一旦提交无法撤销
- 签名前请仔细验证信息
- 如需取消，可以创建新提案

### Q3: 如果签名者不响应怎么办？

**A**: 有几种处理方式
- 等待签名者响应
- 联系签名者提醒
- 如果是 M-of-N，其他签名者可以替代
- 长期不响应可以考虑更换签名者（需要重新创建钱包）

### Q4: CRVA 验证失败怎么办？

**A**: 可能原因和解决方案
- **签名无效**: 重新签名
- **网络问题**: 检查网络连接
- **验证节点故障**: 等待自动重试
- **提案数据错误**: 重新创建提案

### Q5: 多签钱包安全吗？

**A**: 非常安全
- ✅ 需要多个签名才能转账
- ✅ CRVA 验证增加额外安全层
- ✅ 隐私保护（Ring VRF）
- ✅ 分布式验证（无单点故障）
- ⚠️ 但仍需保护好各自的私钥

### Q6: Gas 费用谁支付？

**A**: 由最后签名的人支付
- 创建提案: 不消耗 Gas
- 添加签名: 不消耗 Gas
- 执行交易: 需要 Gas（由触发执行的人支付）
- 建议: 钱包预留一些 ETH 用于 Gas

---

## 🎨 界面预览

### 多签钱包详情页

```
╔═══════════════════════════════════════╗
║  XWallet - 多链加密货币钱包             ║
╠═══════════════════════════════════════╣
║                                       ║
║  我的钱包               [+导入] [+创建] ║
║  ┌─────────────────────────────────┐  ║
║  │ 🔐 ETH DeepSafe 2-of-3          │  ║
║  │ 0xwtf...H6wb                    │  ║
║  └─────────────────────────────────┘  ║
║                                       ║
╠═══════════════════════════════════════╣
║  钱包详情                              ║
║  ┌─────────────────────────────────┐  ║
║  │ 余额                            │  ║
║  │ 0.00 ETH                        │  ║
║  │                                 │  ║
║  │ 📊 查看交易历史                  │  ║
║  └─────────────────────────────────┘  ║
║                                       ║
║  ┌─────────────────────────────────┐  ║
║  │ 🔐 DeepSafe 多签钱包            │  ║
║  │ 2-of-3 多重签名                 │  ║
║  │                                 │  ║
║  │ 签名者 (3):                     │  ║
║  │ 1. 签名者1  [活跃]              │  ║
║  │ 2. 签名者2  [活跃]              │  ║
║  │ 3. 签名者3  [活跃]              │  ║
║  │                                 │  ║
║  │ ✓ CRVA 验证已启用（5个节点）     │  ║
║  └─────────────────────────────────┘  ║
║                                       ║
║  ┌─────────┬─────────┐                ║
║  │📤 创建提案│📥 接收地址│               ║
║  └─────────┴─────────┘                ║
║  ┌─────────┬─────────┐                ║
║  │📋 提案列表│📷 扫描签名│               ║
║  └─────────┴─────────┘                ║
║                                       ║
║  💡 多签流程：创建提案 → 收集签名      ║
║     → CRVA验证 → 达到阈值后自动执行    ║
║                                       ║
╚═══════════════════════════════════════╝
```

---

## 📝 下一步开发计划

### 🚧 正在开发

1. **提案管理系统**
   - 提案列表 UI
   - 提案详情页面
   - 签名状态跟踪
   - 提案历史记录

2. **签名收集机制**
   - 多签名聚合
   - 签名验证
   - 阈值检测
   - 自动执行

3. **CRVA 集成**
   - 与后端 API 连接
   - 验证节点通信
   - Ring VRF 证明
   - 验证结果展示

### 🔮 未来功能

- **提案模板**: 常用转账模板
- **批量提案**: 一次创建多个提案
- **提案投票**: 支持赞成/反对/弃权
- **时间锁**: 设置提案生效时间
- **紧急暂停**: 紧急情况下暂停提案
- **多链支持**: BTC 多签
- **硬件钱包**: Ledger/Trezor 集成

---

## 🎉 总结

现在您的多签钱包已经有完整的操作界面了！

✅ **已完成**:
- 创建多签钱包
- 查看钱包信息
- 显示签名者列表
- 显示 CRVA 状态
- 操作按钮界面

🚧 **进行中**:
- 提案创建功能
- 签名收集机制
- CRVA 验证集成

🔮 **规划中**:
- 更多高级功能
- UI/UX 优化
- 性能提升

---

**开始使用您的 DeepSafe 多签钱包吧！** 🚀
